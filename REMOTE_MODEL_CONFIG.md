# 远程模型配置说明

## 概述

本工具已升级为使用远程模型进行命名实体识别(NER)，不再需要下载本地NER模型。支持以下API类型：

- **OpenAI API** (包括官方API和兼容接口)
- **vLLM** (通过OpenAI兼容接口)
- **其他自定义API**

## 配置步骤

### 1. 打开配置界面

启动应用后，点击菜单栏：`设置` -> `远程模型配置`

### 2. 模型配置

在"模型配置"标签页中填写：

- **API类型**: 选择 `openai`, `anthropic` 或 `custom`
- **API地址**: 远程模型的API端点
  - OpenAI官方: `https://api.openai.com/v1`
  - vLLM本地部署: `http://localhost:8000/v1`
  - 其他自定义服务地址
- **API密钥**: 你的API密钥（某些本地服务可以使用任意值）
- **模型名称**: 要使用的模型名称
  - OpenAI: `gpt-3.5-turbo`, `gpt-4` 等
  - vLLM: 部署的模型名称
- **Temperature**: 控制输出随机性 (0.0-2.0，建议 0.1)
- **Max Tokens**: 最大输出token数 (建议 4096)
- **超时时间**: API请求超时时间（秒）

### 3. NER配置

在"NER配置"标签页中设置：

- **启用并行处理**: 是否并行处理文本块
- **工作线程数**: 并行处理的线程数量 (1-16)
- **最大分块大小**: 单个文本块的最大字符数 (100-2000)
- **支持的实体类型**: 每行输入一个实体类型，例如：
  ```
  人名
  地名
  机构名
  手机号
  身份证号
  银行卡号
  电子邮箱
  IPv4地址
  时间
  ```

### 4. 提示词配置

在"提示词配置"标签页中自定义：

- **系统提示词**: 定义AI助手的角色和任务
- **用户提示词模板**: 使用 `{text}` 作为占位符，将被实际文本替换

示例系统提示词：
```
你是一个专业的命名实体识别助手。请识别文本中的敏感信息，包括：人名、地名、机构名、手机号、身份证号、银行卡号、电子邮箱、IPv4地址、时间。
```

示例用户提示词：
```
请识别以下文本中的实体信息，返回JSON格式，包含字段：span(实体文本), type(实体类型), start(起始位置), end(结束位置), prob(置信度0-1)。

文本：{text}

要求：
1. 返回格式必须是标准JSON数组
2. 每个实体必须包含所有字段
3. start和end是字符位置索引
4. 只返回JSON数组，不要其他说明
```

### 5. 测试连接

配置完成后，点击"测试连接"按钮验证配置是否正确。

### 6. 保存配置

测试成功后，点击"保存"按钮保存配置到 `config.json`。

## vLLM 部署示例

### 启动 vLLM 服务

```bash
# 安装vLLM
pip install vllm

# 启动模型服务（以Qwen为例）
python -m vllm.entrypoints.openai.api_server \
    --model Qwen/Qwen2.5-7B-Instruct \
    --served-model-name qwen2.5-7b \
    --host 0.0.0.0 \
    --port 8000
```

### 配置工具连接vLLM

在配置界面填写：
- API地址: `http://localhost:8000/v1`
- API密钥: `dummy-key` (或任意值)
- 模型名称: `qwen2.5-7b`

## 配置文件位置

配置保存在项目根目录的 `config.json` 文件中，也可以直接编辑该文件。

## 注意事项

1. **API密钥安全**: 请妥善保管API密钥，不要泄露
2. **网络连接**: 确保能够访问远程API服务
3. **提示词优化**: 可根据实际效果调整提示词以获得更好的识别结果
4. **成本控制**: 使用付费API时注意token消耗
5. **本地部署推荐**: 对于敏感数据，建议使用vLLM本地部署

## PDF处理模型

PDF文档处理仍然使用本地模型（PDF-Extract-Kit）。首次使用时：

1. 点击菜单：`帮助` -> `下载PDF处理模型`
2. 等待模型下载完成
3. 模型会自动配置并保存

## 故障排查

### 连接失败
- 检查API地址是否正确
- 确认网络连接正常
- 验证API密钥有效性

### 识别结果不理想
- 调整提示词，使其更明确
- 修改Temperature参数
- 增加Max Tokens限制

### 性能优化
- 启用并行处理
- 调整工作线程数
- 优化分块大小

## 技术支持

如有问题，请联系技术支持或提交Issue到GitHub仓库。
